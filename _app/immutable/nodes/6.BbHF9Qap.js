import"../chunks/Cm9PB-7n.js";import{i as e}from"../chunks/B9xjsR72.js";import{p as t,ap as a,aE as r,g as s,t as o,e as i,b as n,d as l,s as d,h as c,q as u,Q as p,j as m,r as v,n as b,i as h,aF as f}from"../chunks/DyQ3SMX3.js";import{i as g}from"../chunks/DKNJ7q2Q.js";import{e as x,i as w}from"../chunks/DRNAXzN-.js";import{s as y,r as k,a as j}from"../chunks/DSMOxny0.js";import{b as I}from"../chunks/BIVvaVFi.js";import{s as S,a as M}from"../chunks/BVHj_c43.js";import{w as T}from"../chunks/B9paxDza.js";const _={},P=_?.VITE_API_BASE||("undefined"!=typeof window?window.location.origin:"http://localhost:5174"),z=_?.VITE_AUTH_TOKEN||"";async function A(e,t={}){const{method:a="GET",headers:r={},body:s,query:o}=t,i=P?.replace(/\/$/,"")||"",n=/^https?:\/\//i.test(e)?new URL(e):new URL(e,i+"/");if(o&&"object"==typeof o)for(const[c,u]of Object.entries(o))null!=u&&n.searchParams.set(c,String(u));const l={"Content-Type":"application/json",...z?{Authorization:`Bearer ${z}`}:{},...r};try{const e=await fetch(n.toString(),{method:a,headers:l,body:void 0!==s&&"GET"!==a?JSON.stringify(s):void 0}),t=e.status,r=await(async()=>{try{return await e.json()}catch{return null}})(),o=r&&"object"==typeof r&&(!("code"in r)||200===r.code);if(!e.ok||!o){return{ok:!1,status:t,data:r,error:r&&r.message||e.statusText||"Request Error"}}return{ok:!0,status:t,data:r}}catch(d){const e=d&&"object"==typeof d&&"message"in d?d.message:String(d);return{ok:!1,status:0,error:String(e)}}}const C=T([]);function N(e,t,a=3e3){const r=Math.random().toString(36).slice(2)+Date.now().toString(36),s={id:r,type:e,text:t,ttl:a};return C.update(e=>[...e,s]),setTimeout(()=>function(e){C.update(t=>t.filter(t=>t.id!==e))}(r),a),r}function O(e,t){return N("success",e,t)}function B(e,t){return N("error",e,t)}var H=s('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 保存中...</div>'),V=s('<div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 mb-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2v6m0 0V9a2 2 0 00-2-2M9 7a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V9a2 2 0 00-2-2"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">API 凭据配置</h2></div> <div class="space-y-4"><div><label for="apiId" class="block text-sm font-medium text-slate-700 mb-2">API ID</label> <input id="apiId" placeholder="请输入 API ID" type="number" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <div><label for="apiHash" class="block text-sm font-medium text-slate-700 mb-2">API Hash</label> <input id="apiHash" placeholder="请输入 API Hash" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <button class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button></div></div>'),E=s('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 登录中...</div>'),q=s('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 验证中...</div>'),D=s('<div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg"><div class="flex items-center gap-2 mb-3"><svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <span class="text-amber-800 font-medium">验证码验证</span></div> <div class="space-y-3"><div><label for="code" class="block text-sm font-medium text-amber-700 mb-2">验证码</label> <input id="code" placeholder="请输入验证码" class="w-full px-4 py-3 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors duration-200 text-slate-900 placeholder-amber-400 bg-white"/></div> <button class="w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button></div></div>'),J=s('<div class="space-y-4"><div><label for="phoneNumber" class="block text-sm font-medium text-slate-700 mb-2">采集号</label> <input id="phoneNumber" placeholder="+1234567890" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <button class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button> <!></div>'),L=s('<div class="text-center py-12"><h2 class="text-3xl font-bold text-slate-800 mb-4">发码登录</h2> <p class="text-slate-600 text-lg mb-8">登录码:</p> <div class="text-6xl font-bold text-slate-900 tracking-widest mb-8 flex items-center justify-center gap-4"><span> </span> <button class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors" title="复制登录码"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div> <p class="text-slate-500">请将6位登录码发送给 <a href="https://t.me/TeleSearchVipbot" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">管理机器人</a> 进行登录</p></div>'),$=s('<div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"><div class="flex items-center gap-2"><svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <p class="text-red-800 font-medium"> </p></div></div>'),R=s('<div class="text-center py-12"><div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <p class="text-slate-500 text-lg">暂无已登录账号</p> <p class="text-slate-400 text-sm mt-1">请先配置 API 凭据并登录账号</p></div>'),U=s('<div class="flex items-center gap-2"><div class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 采集中</div>'),G=s('<div class="flex items-center justify-between p-4 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition-colors duration-200"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center"><span class="text-white font-semibold text-sm"></span></div> <div><p class="font-medium text-slate-800"> </p> <p class="text-sm text-slate-500">已连接</p></div></div> <button class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm"><!></button></div>'),F=s('<div class="space-y-3"></div>'),K=s('<div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">已登录账号</h2></div> <!> <!></div>'),Q=s('<main class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 py-8 px-4"><div class="max-w-4xl mx-auto"><div class="text-center mb-8"><h1 class="text-4xl font-bold bg-gradient-to-r from-sky-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent mb-2">Telegram Data Collector</h1> <p class="text-slate-600 text-lg">管理您的 Telegram API 凭据和账号登录</p></div> <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 mb-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">账号登录</h2></div> <div class="flex justify-center mb-6"><div class="bg-slate-200 rounded-lg p-1 flex"><button>机器人登录</button> <button>采集号登录</button></div></div> <!> <!></div> <!></div></main>');function W(s,_){t(_,!1);const[P,z]=S(),C=()=>M(Z,"$accounts",P);let W,X=p(""),Y=p(""),Z=T([]),ee=p(""),te=p(""),ae=p(!1),re=p(""),se=p(!1),oe=p("bot"),ie=p("");function ne(e){u(oe,e),"bot"===e?(de(),W&&clearInterval(W),W=setInterval(ce,3e3)):W&&clearInterval(W)}a(()=>{u(X,localStorage.getItem("api_id")||""),u(Y,localStorage.getItem("api_hash")||"");try{const e=JSON.parse(localStorage.getItem("accounts")||"[]");Z.set(e)}catch(e){}"bot"===m(oe)&&(de(),W=setInterval(ce,3e3))});let le="";async function de(){const{ok:e,data:t}=await A("/api/bot/login/generate",{method:"POST"});e&&t?(u(ie,t.loginCode),le=t.token):B("无法生成登录码，请稍后重试")}async function ce(){if(!le)return;const{ok:e,data:t}=await A(`/api/bot/login/status?token=${le}`);e&&"success"===t?.status&&(O("登录成功！"),clearInterval(W),window.location.href="/")}async function ue(){if(navigator.clipboard&&m(ie))try{await navigator.clipboard.writeText(m(ie)),O("登录码已复制")}catch(e){B("无法复制登录码")}else B("剪贴板功能不可用")}function pe(){localStorage.setItem("api_id",m(X)),localStorage.setItem("api_hash",m(Y)),O("API 凭据已保存")}async function me(){u(re,""),u(se,!0);try{const{ok:t,data:a,error:r}=await A("/api/login",{method:"POST",body:{api_id:parseInt(m(X)),api_hash:m(Y),phone_number:m(ee)}});t?"code_required"===a?.status?(u(ae,!0),N("info","已发送验证码，请输入",e)):"success"===a?.status?(Z.update(e=>{const t=[...e,{phone:m(ee),session:a.session}];return localStorage.setItem("accounts",JSON.stringify(t)),t}),u(ee,""),u(ae,!1),O("登录成功")):(u(re,a&&a.error||"Login failed"),B(m(re))):(u(re,r||"Login failed"),B(m(re)))}catch(t){u(re,"Network error: "+t.message),B(m(re))}finally{u(se,!1)}var e}async function ve(){u(re,""),u(se,!0);try{const{ok:e,data:t,error:a}=await A("/api/verify",{method:"POST",body:{api_id:parseInt(m(X)),api_hash:m(Y),phone_number:m(ee),code:m(te)}});e?"success"===t?.status?(Z.update(e=>{const a=[...e,{phone:m(ee),session:t.session}];return localStorage.setItem("accounts",JSON.stringify(a)),a}),u(ee,""),u(te,""),u(ae,!1),O("验证成功，已登录")):(u(re,t&&t.error||"Verification failed"),B(m(re))):(u(re,a||"Verification failed"),B(m(re)))}catch(e){u(re,"Network error: "+e.message),B(m(re))}finally{u(se,!1)}}r(()=>{W&&clearInterval(W)}),e();var be=Q(),he=c(be),fe=d(c(he),2),ge=d(c(fe),2),xe=c(ge),we=c(xe),ye=d(we,2);v(xe),v(ge);var ke=d(ge,2),je=e=>{var t=V(),a=d(c(t),2),r=c(a),s=d(c(r),2);k(s),v(r);var l=d(r,2),p=d(c(l),2);k(p),v(l);var b=d(l,2),h=c(b),x=e=>{var t=H();n(e,t)},w=e=>{var t=f("保存凭据");n(e,t)};g(h,e=>{m(se)?e(x):e(w,!1)}),v(b),v(a),v(t),o(()=>{j(b,"aria-busy",m(se)),b.disabled=m(se)}),I(s,()=>m(X),e=>u(X,e)),I(p,()=>m(Y),e=>u(Y,e)),i("click",b,pe),n(e,t)};g(ke,e=>{"phone"===m(oe)&&e(je)});var Ie=d(ke,2),Se=e=>{var t=J(),a=c(t),r=d(c(a),2);k(r),v(a);var s=d(a,2),l=c(s),p=e=>{var t=E();n(e,t)},b=e=>{var t=f("开始登录");n(e,t)};g(l,e=>{m(se)?e(p):e(b,!1)}),v(s);var h=d(s,2),x=e=>{var t=D(),a=d(c(t),2),r=c(a),s=d(c(r),2);k(s),v(r);var l=d(r,2),p=c(l),b=e=>{var t=q();n(e,t)},h=e=>{var t=f("提交验证码");n(e,t)};g(p,e=>{m(se)?e(b):e(h,!1)}),v(l),v(a),v(t),o(()=>{j(l,"aria-busy",m(se)),l.disabled=m(se)}),I(s,()=>m(te),e=>u(te,e)),i("click",l,ve),n(e,t)};g(h,e=>{m(ae)&&e(x)}),v(t),o(()=>{j(s,"aria-busy",m(se)),s.disabled=m(se)}),I(r,()=>m(ee),e=>u(ee,e)),i("click",s,me),n(e,t)},Me=e=>{var t=L(),a=d(c(t),4),r=c(a),s=c(r,!0);v(r);var l=d(r,2);v(a),b(2),v(t),o(()=>h(s,m(ie))),i("click",l,ue),n(e,t)};g(Ie,e=>{"phone"===m(oe)?e(Se):e(Me,!1)}),v(fe);var Te=d(fe,2),_e=e=>{var t=K(),a=d(c(t),2),r=e=>{var t=$(),a=c(t),r=d(c(a),2),s=c(r,!0);v(r),v(a),v(t),o(()=>h(s,m(re))),n(e,t)};g(a,e=>{m(re)&&e(r)});var s=d(a,2),l=e=>{var t=R();n(e,t)},p=e=>{var t=F();x(t,5,C,w,(e,t,a)=>{var r=G(),s=c(r),l=c(s);c(l).textContent=a+1,v(l);var p=d(l,2),x=c(p),w=c(x,!0);v(x),b(2),v(p),v(s);var y=d(s,2),k=c(y),I=e=>{var t=U();n(e,t)},S=e=>{var t=f("开始采集");n(e,t)};g(k,e=>{m(se)?e(I):e(S,!1)}),v(y),v(r),o(()=>{h(w,m(t).phone),j(y,"aria-busy",m(se)),y.disabled=m(se)}),i("click",y,()=>async function(e){try{const{ok:t,data:a,error:r}=await A("/api/collect",{method:"POST",body:{phone_number:e}});t?"success"===a?.status?O("已启动采集: "+e):(u(re,a&&a.error||"Collection failed"),B(m(re))):B(r||"采集启动失败")}catch(t){u(re,"Network error: "+t.message),B(m(re))}}(m(t).phone)),n(e,r)}),v(t),n(e,t)};g(s,e=>{0===C().length?e(l):e(p,!1)}),v(t),n(e,t)};g(Te,e=>{"phone"===m(oe)&&e(_e)}),v(he),v(be),o(()=>{y(we,1,"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("bot"===m(oe)?"bg-white text-blue-600 shadow":"text-slate-600")),y(ye,1,"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("phone"===m(oe)?"bg-white text-blue-600 shadow":"text-slate-600"))}),i("click",we,()=>ne("bot")),i("click",ye,()=>ne("phone")),n(s,be),l(),z()}export{W as component};
