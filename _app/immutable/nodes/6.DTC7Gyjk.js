import"../chunks/Cm9PB-7n.js";import{i as e}from"../chunks/BV4TV12-.js";import{p as t,o as r,f as a,t as s,g as o,e as i,a as n,b as l,s as d,c,d as u,m,r as p,aK as h,i as v,n as b}from"../chunks/Dcj_b-T1.js";import{i as f}from"../chunks/np65tVUW.js";import{e as g,i as x}from"../chunks/xCKIWgcL.js";import{r as w,s as y}from"../chunks/BA91tbR7.js";import{b as k}from"../chunks/Cu2qomNb.js";import{s as j,a as I}from"../chunks/BRTNnow_.js";import{w as S}from"../chunks/nRpcsI4f.js";const M={},_=M?.VITE_API_BASE||("undefined"!=typeof window?window.location.origin:"http://localhost:5174"),T=M?.VITE_AUTH_TOKEN||"";async function P(e,t={}){const{method:r="GET",headers:a={},body:s,query:o}=t,i=_?.replace(/\/$/,"")||"",n=/^https?:\/\//i.test(e)?new URL(e):new URL(e,i+"/");if(o&&"object"==typeof o)for(const[c,u]of Object.entries(o))null!=u&&n.searchParams.set(c,String(u));const l={"Content-Type":"application/json",...T?{Authorization:`Bearer ${T}`}:{},...a};try{const e=await fetch(n.toString(),{method:r,headers:l,body:void 0!==s&&"GET"!==r?JSON.stringify(s):void 0}),t=e.status,a=await(async()=>{try{return await e.json()}catch{return null}})(),o=a&&"object"==typeof a&&(!("code"in a)||200===a.code);if(!e.ok||!o){return{ok:!1,status:t,data:a,error:a&&a.message||e.statusText||"Request Error"}}return{ok:!0,status:t,data:a}}catch(d){const e=d&&"object"==typeof d&&"message"in d?d.message:String(d);return{ok:!1,status:0,error:String(e)}}}const A=S([]);function z(e,t,r=3e3){const a=Math.random().toString(36).slice(2)+Date.now().toString(36),s={id:a,type:e,text:t,ttl:r};return A.update(e=>[...e,s]),setTimeout(()=>function(e){A.update(t=>t.filter(t=>t.id!==e))}(a),r),a}function C(e,t){return z("success",e,t)}function N(e,t){return z("error",e,t)}var O=a('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 保存中...</div>'),B=a('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 登录中...</div>'),H=a('<div class="flex items-center justify-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 验证中...</div>'),E=a('<div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg"><div class="flex items-center gap-2 mb-3"><svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <span class="text-amber-800 font-medium">验证码验证</span></div> <div class="space-y-3"><div><label for="code" class="block text-sm font-medium text-amber-700 mb-2">验证码</label> <input id="code" placeholder="请输入验证码" class="w-full px-4 py-3 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors duration-200 text-slate-900 placeholder-amber-400 bg-white"/></div> <button class="w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button></div></div>'),V=a('<div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"><div class="flex items-center gap-2"><svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <p class="text-red-800 font-medium"> </p></div></div>'),D=a('<div class="text-center py-12"><div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <p class="text-slate-500 text-lg">暂无已登录账号</p> <p class="text-slate-400 text-sm mt-1">请先配置 API 凭据并登录账号</p></div>'),J=a('<div class="flex items-center gap-2"><div class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"></div> 采集中</div>'),L=a('<div class="flex items-center justify-between p-4 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition-colors duration-200"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center"><span class="text-white font-semibold text-sm"></span></div> <div><p class="font-medium text-slate-800"> </p> <p class="text-sm text-slate-500">已连接</p></div></div> <button class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-sm"><!></button></div>'),q=a('<div class="space-y-3"></div>'),R=a('<main class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 py-8 px-4"><div class="max-w-4xl mx-auto"><div class="text-center mb-8"><h1 class="text-4xl font-bold bg-gradient-to-r from-sky-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent mb-2">Telegram Data Collector</h1> <p class="text-slate-600 text-lg">管理您的 Telegram API 凭据和账号登录</p></div> <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 mb-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2m-2-2v6m0 0V9a2 2 0 00-2-2M9 7a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V9a2 2 0 00-2-2"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">API 凭据配置</h2></div> <div class="space-y-4"><div><label for="apiId" class="block text-sm font-medium text-slate-700 mb-2">API ID</label> <input id="apiId" placeholder="请输入 API ID" type="number" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <div><label for="apiHash" class="block text-sm font-medium text-slate-700 mb-2">API Hash</label> <input id="apiHash" placeholder="请输入 API Hash" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <button class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button></div></div> <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 mb-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">账号登录</h2></div> <div class="space-y-4"><div><label for="phoneNumber" class="block text-sm font-medium text-slate-700 mb-2">手机号码</label> <input id="phoneNumber" placeholder="+1234567890" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-slate-900 placeholder-slate-400"/></div> <button class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"><!></button> <!></div></div> <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 hover:shadow-xl transition-all duration-300"><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <h2 class="text-xl font-semibold text-slate-800">已登录账号</h2></div> <!> <!></div></div></main>');function U(a,M){t(M,!1);const[_,T]=j(),A=()=>I(G,"$accounts",_);let U=m(""),$=m(""),G=S([]),K=m(""),F=m(""),Q=m(!1),W=m(""),X=m(!1);async function Y(){u(W,""),u(X,!0);try{const{ok:e,data:t,error:r}=await P("/api/verify",{method:"POST",body:{api_id:parseInt(o(U)),api_hash:o($),phone_number:o(K),code:o(F)}});e?"success"===t?.status?(G.update(e=>{const r=[...e,{phone:o(K),session:t.session}];return localStorage.setItem("accounts",JSON.stringify(r)),r}),u(K,""),u(F,""),u(Q,!1),C("验证成功，已登录")):(u(W,t&&t.error||"Verification failed"),N(o(W))):(u(W,r||"Verification failed"),N(o(W)))}catch(e){u(W,"Network error: "+e.message),N(o(W))}finally{u(X,!1)}}r(()=>{u(U,localStorage.getItem("api_id")||""),u($,localStorage.getItem("api_hash")||"");try{const e=JSON.parse(localStorage.getItem("accounts")||"[]");G.set(e)}catch(e){}}),e();var Z=R(),ee=c(Z),te=d(c(ee),2),re=d(c(te),2),ae=c(re),se=d(c(ae),2);w(se),p(ae);var oe=d(ae,2),ie=d(c(oe),2);w(ie),p(oe);var ne=d(oe,2),le=c(ne),de=e=>{var t=O();n(e,t)},ce=e=>{var t=h("保存凭据");n(e,t)};f(le,e=>{o(X)?e(de):e(ce,!1)}),p(ne),p(re),p(te);var ue=d(te,2),me=d(c(ue),2),pe=c(me),he=d(c(pe),2);w(he),p(pe);var ve=d(pe,2),be=c(ve),fe=e=>{var t=B();n(e,t)},ge=e=>{var t=h("开始登录");n(e,t)};f(be,e=>{o(X)?e(fe):e(ge,!1)}),p(ve);var xe=d(ve,2),we=e=>{var t=E(),r=d(c(t),2),a=c(r),l=d(c(a),2);w(l),p(a);var m=d(a,2),v=c(m),b=e=>{var t=H();n(e,t)},g=e=>{var t=h("提交验证码");n(e,t)};f(v,e=>{o(X)?e(b):e(g,!1)}),p(m),p(r),p(t),s(()=>{y(m,"aria-busy",o(X)),m.disabled=o(X)}),k(l,()=>o(F),e=>u(F,e)),i("click",m,Y),n(e,t)};f(xe,e=>{o(Q)&&e(we)}),p(me),p(ue);var ye=d(ue,2),ke=d(c(ye),2),je=e=>{var t=V(),r=c(t),a=d(c(r),2),i=c(a,!0);p(a),p(r),p(t),s(()=>v(i,o(W))),n(e,t)};f(ke,e=>{o(W)&&e(je)});var Ie=d(ke,2),Se=e=>{var t=D();n(e,t)},Me=e=>{var t=q();g(t,5,A,x,(e,t,r)=>{var a=L(),l=c(a),m=c(l);c(m).textContent=r+1,p(m);var g=d(m,2),x=c(g),w=c(x,!0);p(x),b(2),p(g),p(l);var k=d(l,2),j=c(k),I=e=>{var t=J();n(e,t)},S=e=>{var t=h("开始采集");n(e,t)};f(j,e=>{o(X)?e(I):e(S,!1)}),p(k),p(a),s(()=>{v(w,o(t).phone),y(k,"aria-busy",o(X)),k.disabled=o(X)}),i("click",k,()=>async function(e){try{const{ok:t,data:r,error:a}=await P("/api/collect",{method:"POST",body:{phone_number:e}});t?"success"===r?.status?C("已启动采集: "+e):(u(W,r&&r.error||"Collection failed"),N(o(W))):N(a||"采集启动失败")}catch(t){u(W,"Network error: "+t.message),N(o(W))}}(o(t).phone)),n(e,a)}),p(t),n(e,t)};f(Ie,e=>{0===A().length?e(Se):e(Me,!1)}),p(ye),p(ee),p(Z),s(()=>{y(ne,"aria-busy",o(X)),ne.disabled=o(X),y(ve,"aria-busy",o(X)),ve.disabled=o(X)}),k(se,()=>o(U),e=>u(U,e)),k(ie,()=>o($),e=>u($,e)),i("click",ne,function(){localStorage.setItem("api_id",o(U)),localStorage.setItem("api_hash",o($)),C("API 凭据已保存")}),k(he,()=>o(K),e=>u(K,e)),i("click",ve,async function(){u(W,""),u(X,!0);try{const{ok:t,data:r,error:a}=await P("/api/login",{method:"POST",body:{api_id:parseInt(o(U)),api_hash:o($),phone_number:o(K)}});t?"code_required"===r?.status?(u(Q,!0),z("info","已发送验证码，请输入",e)):"success"===r?.status?(G.update(e=>{const t=[...e,{phone:o(K),session:r.session}];return localStorage.setItem("accounts",JSON.stringify(t)),t}),u(K,""),u(Q,!1),C("登录成功")):(u(W,r&&r.error||"Login failed"),N(o(W))):(u(W,a||"Login failed"),N(o(W)))}catch(t){u(W,"Network error: "+t.message),N(o(W))}finally{u(X,!1)}var e}),n(a,Z),l(),T()}export{U as component};
